# DS-001: DroneStuff Flutter Mission Manager

**Type:** Epic
**Phase:** All
**Status:** Open

## Summary

Build a Flutter Android app that manages DJI GoFly waypoint missions directly on the phone. Replace the current laptop+ADB workflow (`tools/push_waypoints.py`) with an on-device tool that can view, import, split, merge, edit, and push KMZ waypoint files.

## Motivation

Splitting long Litchi Hub missions into battery-sized segments requires manually controlling `finishAction` per segment (intermediate segments should hover/noAction, final segment returns home). Currently this requires a laptop, ADB, and manual file manipulation. An on-device app makes this a field-ready workflow.

## Architecture

- **Flutter/Dart** for all UI and business logic
- **Thin Kotlin bridge** for Shizuku AIDL file access (Android 13+ scoped storage blocks direct access to DJI's app directory)
- **Riverpod** state management, **Drift** local DB, **flutter_map** for route visualization

## Sub-Issues

| Issue | Title | Phase |
|---|---|---|
| [DS-002](DS-002.md) | Flutter project setup | 1 - Infrastructure |
| [DS-003](DS-003.md) | Shizuku platform channel bridge | 1 - Infrastructure |
| [DS-004](DS-004.md) | KMZ parser and data models | 1 - Infrastructure |
| [DS-005](DS-005.md) | KMZ writer | 1 - Infrastructure |
| [DS-006](DS-006.md) | Drift database + local repository | 1 - Infrastructure |
| [DS-007](DS-007.md) | Home screen with Device/Local tabs | 2 - Viewer |
| [DS-008](DS-008.md) | Mission detail + map view | 2 - Viewer |
| [DS-009](DS-009.md) | Mission push to device | 3 - Push |
| [DS-010](DS-010.md) | Split/merge/edit with finishAction | 4 - Split/Edit |

## Key Design Decisions

| Decision | Choice | Rationale |
|---|---|---|
| UI Framework | Flutter/Dart | User preference, fast iteration |
| Map library | `flutter_map` + OSM tiles | No API key needed, personal tool |
| State mgmt | Riverpod | Compile-safe, no BuildContext needed |
| Local DB | Drift (SQLite) | Type-safe, code-gen, migrations |
| File access | Shizuku UserService via AIDL | Only viable option for Android 13+ |
| Min SDK | 33 (Android 13) | User's device |

## Device Waypoint Directory Layout

```
/sdcard/Android/data/dji.go.v5/files/waypoint/
├── {UUID}/
│   ├── {UUID}.kmz          ← PRIMARY (replace this)
│   └── image/ShotSnap.json
├── kmzTemp/
│   └── {UUID}.kmz          ← COPY (replace this too)
├── map_preview/{UUID}/
│   └── {UUID}.jpg
└── capability/*.json
```

## Reference Files

- `tools/push_waypoints.py` — working Python implementation to port from
- `docs/Havasu Lake Desert.kmz` — 395-waypoint Litchi mission (test fixture)
- `docs/Havasu Lake Desert_{1,2,3}.kmz` — pre-split variants (150/150/97 waypoints)
