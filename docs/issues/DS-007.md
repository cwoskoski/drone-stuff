# DS-007: Home Screen with Device/Local Tabs + Shizuku Banner

**Type:** Task
**Phase:** 2 - Viewer
**Status:** Open
**Blocks:** DS-008, DS-009
**Blocked by:** DS-003, DS-004, DS-006

## Summary

Build the main home screen with two tabs (Device Missions / Local Missions) and a Shizuku setup banner that guides the user through connecting Shizuku for device file access.

## Screens & Widgets

### `lib/features/home/home_screen.dart`
- Scaffold with TabBar: **Device** | **Local**
- FAB: Import KMZ (opens file picker, uses `file_picker` package)
- Shows `ShizukuBanner` above the Device tab when Shizuku isn't ready

### `lib/features/home/widgets/shizuku_banner.dart`
- Contextual banner based on `ShizukuState`:
  - `notInstalled` → "Install Shizuku from Play Store" with link
  - `notRunning` → "Open Shizuku and start it via Wireless Debugging"
  - `permissionNeeded` → "Tap to grant DroneStuff access" (calls `requestShizukuPermission`)
  - `ready` → Banner hidden
- Dismissible, but reappears if state changes

### `lib/features/missions/device/device_missions_screen.dart`
- Lists missions discovered on device via Shizuku
- For each UUID folder: pull KMZ, parse metadata, show card
- Card shows: UUID (truncated), author, create time, waypoint count, file size
- Pull-to-refresh
- Tap → navigate to DS-008 detail screen
- Loading/empty/error states

### `lib/features/missions/device/device_missions_provider.dart`
- `listDeviceMissions()`:
  1. `shizukuChannel.listFiles(WAYPOINT_ROOT)` → filter UUID-matching names
  2. For each UUID: `readFile('{WAYPOINT_ROOT}/{uuid}/{uuid}.kmz')`
  3. Parse with `KmzParser.parseBytes()` to extract metadata
  4. Return `List<DeviceMission>`
- Exposes `AsyncNotifier<List<DeviceMission>>`

### `lib/features/missions/local/local_missions_screen.dart`
- Lists imported missions from Drift DB
- Card shows: filename, author, waypoint count, import date, source type badge
- Swipe to delete
- Tap → navigate to detail screen
- Split segments grouped under parent

### `lib/features/missions/local/local_missions_provider.dart`
- Watches `MissionDao.getAllMissions()` stream
- Exposes `Stream<List<MissionEntity>>`

### `lib/features/missions/import/import_provider.dart`
- `importKmzFile()`:
  1. Open file picker (filter: `.kmz`)
  2. Read file bytes
  3. Parse with `KmzParser` (validate)
  4. Store via `LocalMissionRepository.importKmz()`
  5. Show success toast

### `lib/routing/app_router.dart`
- GoRouter with routes: `/` (home), `/detail/:id/:source`, `/push/:id`, `/split/:id`, `/edit/:id`, `/settings`

## Acceptance Criteria

- [ ] Home screen shows two tabs that switch between Device and Local views
- [ ] Shizuku banner appears when Shizuku isn't ready, with correct message per state
- [ ] Tapping "grant permission" on the banner triggers the Shizuku dialog
- [ ] After granting, Device tab loads and shows existing mission(s) on device
- [ ] Device mission card shows UUID, author, waypoint count, size
- [ ] FAB opens file picker, imports KMZ, and it appears in Local tab
- [ ] Local tab shows imported missions with metadata
- [ ] Tapping a mission navigates to detail screen
