# DS-008: Mission Detail Screen + Map View

**Type:** Task
**Phase:** 2 - Viewer
**Status:** Open
**Blocks:** DS-009, DS-010
**Blocked by:** DS-004, DS-007

## Summary

Build the mission detail screen showing full metadata and a map visualization of the waypoint route using `flutter_map` with OpenStreetMap tiles.

## Screens & Widgets

### `lib/features/missions/detail/mission_detail_screen.dart`
- Accepts mission ID + source (`device` or `local`)
- Header with mission name/filename
- Metadata card:
  - Author, create time, update time
  - Waypoint count, finish action (highlighted if `goHome`)
  - Fly-to mode, RC lost action
  - Flight speed, transitional speed
  - Drone enum values
  - File size
- Action buttons row:
  - **View Map** → navigate to map screen
  - **Push to Device** → navigate to DS-009 push screen (local missions only)
  - **Split** → navigate to DS-010 split screen
  - **Edit** → navigate to DS-010 edit screen
- Expandable waypoint list:
  - Index, lat/lon, altitude, speed
  - Tap to expand: heading params, action groups

### `lib/features/missions/detail/mission_detail_provider.dart`
- Loads full `Mission` model from either:
  - Device: fetch via Shizuku + parse
  - Local: load from app storage + parse
- Caches parsed mission for the session

### `lib/features/missions/detail/widgets/mission_info_card.dart`
- Reusable card composable showing mission metadata
- Color-codes `finishAction` (green for goHome, amber for noAction)

### `lib/features/missions/map/mission_map_screen.dart`
- Full-screen `flutter_map` widget
- OpenStreetMap tile layer (no API key)
- Polyline connecting all waypoints in route order
- Numbered circle markers at each waypoint (or every Nth for large missions)
- Auto-fit camera to bounding box of all waypoints
- Tap marker → bottom sheet with waypoint details (index, coords, altitude, speed, actions)
- Optional satellite tiles toggle (Esri World Imagery as secondary layer)

### `lib/features/missions/map/widgets/waypoint_marker.dart`
- Small numbered circle with index
- Color-coded (can be used by DS-010 split preview for segment colors)

### `lib/features/missions/map/widgets/route_polyline.dart`
- Polyline layer connecting waypoints
- Supports multiple colors for split preview (segment visualization)

### `lib/features/missions/map/mission_map_provider.dart`
- Computes bounds from waypoint list
- Provides marker and polyline data to the map widget

## Acceptance Criteria

- [ ] Detail screen shows all metadata for both device and local missions
- [ ] `finishAction` is prominently displayed and color-coded
- [ ] Map shows waypoint route over correct geographic location (Havasu Lake area for test data)
- [ ] Polyline connects waypoints in order
- [ ] Waypoint markers show index numbers
- [ ] Camera auto-fits to show entire route
- [ ] Tapping a marker shows waypoint details
- [ ] Action buttons navigate to correct screens
- [ ] Works for missions with 395 waypoints (no performance issues)
